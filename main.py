import openpyxl
from openpyxl.styles import Font, Alignment, PatternFill, Border, Side
from openpyxl.utils import get_column_letter

# ----------------------------------
# 1) Дані для кожного кроку (аркуша)
# ----------------------------------
# Формат кожного елемента списку:
# {
#   "sheet_title": "Назва аркуша",
#   "header": "Текст заголовка (опис операції)",
#   "data": [
#       (Актив_назва, Актив_сума, Пасив_назва, Пасив_сума),
#       ...
#   ]
# }
# Суми по Активу та Пасиву перевірені вручну і збігаються
# ----------------------------------

steps_data = [
    {
        "sheet_title": "1 Березня",
        "header": "1-го березня - реєстрація підприємства та внесок в уставний фонд",
        "data": [
            ("Рахунок", 20000, "Приватний капітал", 20000),
        ]
    },
    {
        "sheet_title": "3 Березня",
        "header": "3-го березня - отримано банківський кредит (10000 грн)",
        "data": [
            ("Рахунок", 30000, "Приватний капітал", 20000),
            (None, None, "Банківський кредит", 10000),
        ]
    },
    {
        "sheet_title": "10 Березня",
        "header": "10-го березня - купівля обладнання (15000 грн) і сировини (10000 грн)",
        "data": [
            ("Рахунок", 5000, "Приватний капітал", 20000),
            ("Обладнання", 15000, "Банківський кредит", 10000),
            ("Сировина", 10000, None, None),
        ]
    },
    {
        "sheet_title": "30 Березня",
        "header": "30-го березня - вироблено і реалізовано продукцію, отримано прибуток 7000, 40% податків",
        "data": [
            ("Рахунок", 20000, "Приватний капітал", 20000),
            ("Обладнання", 15000, "Банківський кредит", 10000),
            ("Сировина", 5000, "Нарощений капітал (приб.)", 4200),
            (None, None, "Заборг. держ.бюджет (податок)", 2800),
            (None, None, "Заборг. по витратах", 3000),
        ]
    },
    {
        "sheet_title": "1 Квітня",
        "header": "1-го квітня - погашення податку, витрат та 50% залишку кредиту",
        "data": [
            ("Рахунок", 9200, "Приватний капітал", 20000),
            ("Обладнання", 15000, "Банківський кредит", 5000),
            ("Сировина", 5000, "Нарощений капітал (приб.)", 4200),
            (None, None, "Заборг. держ.бюджет (податок)", 0),
            (None, None, "Заборг. по витратах", 0),
        ]
    },
    {
        "sheet_title": "2 Квітня",
        "header": "2 квітня - купівля сировини на 5000 грн",
        "data": [
            ("Рахунок", 4200, "Приватний капітал", 20000),
            ("Обладнання", 15000, "Банківський кредит", 5000),
            ("Сировина", 10000, "Нарощений капітал (приб.)", 4200),
            (None, None, "Заборг. держ.бюджет (податок)", 0),
            (None, None, "Заборг. по витратах", 0),
        ]
    },
    {
        "sheet_title": "22 Квітня",
        "header": "22-го квітня - реалізація (15 000 грн), витрати 3000, податок 40%",
        "data": [
            ("Рахунок", 19200, "Приватний капітал", 20000),
            ("Обладнання", 15000, "Банківський кредит", 5000),
            ("Сировина", 5000, "Нарощений капітал (приб.)", 8400),
            (None, None, "Заборг. держ.бюджет (податок)", 2800),
            (None, None, "Заборг. по витратах", 3000),
        ]
    },
    {
        "sheet_title": "23 Квітня",
        "header": "23-го квітня - погашення податків, витрат та 50% кредиту (залишку)",
        "data": [
            ("Рахунок", 10900, "Приватний капітал", 20000),
            ("Обладнання", 15000, "Банківський кредит", 2500),
            ("Сировина", 5000, "Нарощений капітал (приб.)", 8400),
            (None, None, "Заборг. держ.бюджет", 0),
            (None, None, "Заборг. по витратах", 0),
        ]
    },
    {
        "sheet_title": "24 Квітня",
        "header": "24 квітня - купівля сировини (6000 грн)",
        "data": [
            ("Рахунок", 4900, "Приватний капітал", 20000),
            ("Обладнання", 15000, "Банківський кредит", 2500),
            ("Сировина", 11000, "Нарощений капітал (приб.)", 8400),
            (None, None, "Заборг. держ.бюджет", 0),
            (None, None, "Заборг. по витратах", 0),
        ]
    },
    {
        "sheet_title": "3 Червня",
        "header": "3-го червня - реалізація (30 000 грн), витрати 6000, податок 40%",
        "data": [
            ("Рахунок", 34900, "Приватний капітал", 20000),
            ("Обладнання", 15000, "Банківський кредит", 2500),
            ("Сировина", 1000, "Нарощений капітал (приб.)", 16800),
            (None, None, "Заборг. держ.бюджет", 5600),
            (None, None, "Заборг. по витратах", 6000),
        ]
    },
    {
        "sheet_title": "4 Червня",
        "header": "4-го червня - погашення податку, витрат та 50% кредиту",
        "data": [
            ("Рахунок", 22050, "Приватний капітал", 20000),
            ("Обладнання", 15000, "Банківський кредит", 1250),
            ("Сировина", 1000, "Нарощений капітал (приб.)", 16800),
            (None, None, "Заборг. держ.бюджет", 0),
            (None, None, "Заборг. по витратах", 0),
        ]
    },
    {
        "sheet_title": "5 Травня",
        "header": "5-го травня - купівля сировини на 9000 грн (дані йдуть після 4 червня у прикладі)",
        "data": [
            ("Рахунок", 13050, "Приватний капітал", 20000),
            ("Обладнання", 15000, "Банківський кредит", 1250),
            ("Сировина", 10000, "Нарощений капітал (приб.)", 16800),
            (None, None, "Заборг. держ.бюджет", 0),
            (None, None, "Заборг. по витратах", 0),
        ]
    },
    {
        "sheet_title": "25 Червня",
        "header": "25-го червня - реалізація (15 000 грн), витрати 3000, податок 40%",
        "data": [
            ("Рахунок", 28050, "Приватний капітал", 20000),
            ("Обладнання", 15000, "Банківський кредит", 1250),
            ("Сировина", 5000, "Нарощений капітал (приб.)", 21000),
            (None, None, "Заборг. держ.бюджет", 2800),
            (None, None, "Заборг. по витратах", 3000),
        ]
    },
    {
        "sheet_title": "26 Червня",
        "header": "26-го червня - погашення податку, витрат та залишку кредиту",
        "data": [
            ("Рахунок", 21000, "Приватний капітал", 20000),
            ("Обладнання", 15000, "Банківський кредит", 0),
            ("Сировина", 5000, "Нарощений капітал (приб.)", 21000),
            (None, None, "Заборг. держ.бюджет", 0),
            (None, None, "Заборг. по витратах", 0),
        ]
    },
]


# -------------------------------------------------
# 2) Функції для створення і форматування таблиць
# -------------------------------------------------

def create_sheet_headers(sheet, title_text):
    """
    Створює заголовок (title_text) у верхньому рядку.
    Також створює шапку з назвами стовпців: A/B (Актив, грн), D/E (Пасив, грн).
    """
    # Зливання комірок під заголовок
    sheet.merge_cells("A1:E1")
    sheet["A1"] = title_text
    sheet["A1"].font = Font(bold=True, size=13)
    sheet["A1"].alignment = Alignment(horizontal="center", vertical="center")

    # Шапка для таблиці
    sheet["A2"] = "Актив"
    sheet["B2"] = "грн"
    sheet["D2"] = "Пасив"
    sheet["E2"] = "грн"

    # Підкреслимо жирним
    for cell_coord in ["A2", "B2", "D2", "E2"]:
        sheet[cell_coord].font = Font(bold=True)

    # Задамо ширину стовпців
    sheet.column_dimensions["A"].width = 28
    sheet.column_dimensions["B"].width = 12
    sheet.column_dimensions["C"].width = 3
    sheet.column_dimensions["D"].width = 30
    sheet.column_dimensions["E"].width = 12

    # Зробимо тло заголовків залитим
    header_fill = PatternFill(start_color="FFD966", end_color="FFD966", fill_type="solid")
    sheet["A2"].fill = header_fill
    sheet["B2"].fill = header_fill
    sheet["D2"].fill = header_fill
    sheet["E2"].fill = header_fill


def fill_data(sheet, data_rows):
    """
    Заповнює дані у стовпцях A/B (Актив, грн) та D/E (Пасив, грн).
    data_rows - список кортежів (active_name, active_val, passive_name, passive_val).
    Додає підсумок 'Сума' наприкінці.
    """
    start_row = 3
    thin_border = Border(
        left=Side(style='thin'),
        right=Side(style='thin'),
        top=Side(style='thin'),
        bottom=Side(style='thin')
    )

    # Записуємо рядки
    for i, row_data in enumerate(data_rows, start=start_row):
        active_name, active_val, passive_name, passive_val = row_data

        # Актив (стовпці A, B)
        sheet[f"A{i}"] = active_name if active_name else ""
        sheet[f"B{i}"] = active_val if active_val else ""

        # Пасив (стовпці D, E)
        sheet[f"D{i}"] = passive_name if passive_name else ""
        sheet[f"E{i}"] = passive_val if passive_val else ""

        # Застосуємо межі (border)
        for col in ["A", "B", "D", "E"]:
            sheet[f"{col}{i}"].border = thin_border

    # Додаємо останній рядок "Сума"
    end_row = start_row + len(data_rows)
    sheet[f"A{end_row}"] = "Сума"
    sheet[f"A{end_row}"].font = Font(bold=True)
    sheet[f"D{end_row}"] = "Сума"
    sheet[f"D{end_row}"].font = Font(bold=True)

    # Формули
    sheet[f"B{end_row}"] = f"=SUM(B{start_row}:B{end_row-1})"
    sheet[f"B{end_row}"].font = Font(bold=True)

    sheet[f"E{end_row}"] = f"=SUM(E{start_row}:E{end_row-1})"
    sheet[f"E{end_row}"].font = Font(bold=True)

    # Межі для підсумкових клітинок
    for col in ["A", "B", "D", "E"]:
        sheet[f"{col}{end_row}"].border = thin_border


def main():
    # Створюємо нову книгу
    wb = openpyxl.Workbook()
    # Видалимо стандартний перший аркуш (Sheet), щоб не заважав
    std_sheet = wb.active
    wb.remove(std_sheet)

    # Створюємо послідовно аркуші на основі steps_data
    for step in steps_data:
        sheet = wb.create_sheet(step["sheet_title"])
        # 1) Заголовок
        create_sheet_headers(sheet, step["header"])
        # 2) Дані
        fill_data(sheet, step["data"])

    # Зберігаємо у файл (назву можна змінити на свій розсуд)
    file_name = "synthetic_model_new.xlsx"
    wb.save(file_name)
    print(f"Файл '{file_name}' успішно створено!")


if __name__ == "__main__":
    main()
